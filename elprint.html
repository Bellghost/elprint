<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>canvas</title>
    <style>
      html,
      body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      .ful-screen-container {
        display: grid;
        height: 100%;
        width: 100%;
        margin: 0;
        background-color: darkgrey;
      }

      #operation-bar {
        width: 100%;
        height: 40px;
        background-color: lightgray;
        display: flex;
        align-items: center;
        padding-left: 10px;
      }

      #drawing-board {
        flex: 1;
        touch-action: none;
      }

      #print-toolbar {
        width: 200px;
        min-width: 200px;
        height: 100%;

        #color-selector {
          width: 100%;
          height: 40%;
        }

        #print-tool-selector {
          width: 100%;
          height: 60%;
        }
      }
    </style>
  </head>

  <body>
    <div class="ful-screen-container">
      <header id="operation-bar">
        <button id="save-btn">保存</button>
      </header>

      <canvas id="drawing-board">
        你的浏览器不支持 canvas，请升级你的浏览器。
      </canvas>

      <div id="print-toolbar">
        <canvas id="color-selector">
          你的浏览器不支持 canvas，请升级你的浏览器。
        </canvas>

        <canvas id="print-tool-selector">
          你的浏览器不支持 canvas，请升级你的浏览器。
        </canvas>
      </div>
    </div>
    <script type="module" src="./drawingBoard/init.js"></script>
    <script type="module" src="./operation/init.js"></script>
    <script type="text/javascript">
      const colorSelector = document.getElementById("color-selector");
      const printToolSelector = document.getElementById("print-tool-selector");

      function initColorSelectorSize() {
        // 获取父容器的实际尺寸
        const parentWidth = colorSelector.parentElement.clientWidth;
        const parentHeight = colorSelector.parentElement.clientHeight;

        // 设置 canvas 的实际分辨率
        colorSelector.width = parentWidth;
        colorSelector.height = parentHeight * 0.4;
      }

      function drawAngularGradientRing(
        ctx,
        centerX,
        centerY,
        innerRadius,
        outerRadius,
        segments = 128 * 3,
      ) {
        const angleStep = (Math.PI * 2) / segments; // 每个小扇形的角度
        let r = 255;
        let g = 0;
        let b = 0;
        for (let i = 0; i < segments; i++) {
          const startAngle = i * angleStep;
          const endAngle = (i + 1) * angleStep;

          if (i < 64) {
            g += 4; // 渐变成rgb(255, 255, 0)
          } else if (i < 128) {
            r -= 4; // 渐变成rgb(0, 255, 0)
          } else if (i < 192) {
            b += 4; // 渐变成rgb(0, 255, 255)
          } else if (i < 256) {
            g -= 4; // 渐变成rgb(0, 0, 255)
          } else if (i < 320) {
            r += 4; // 渐变成rgb(255, 0, 255)
          } else if (i < 384) {
            b -= 2; // 渐变成rgb(255, 0, 0)
          }

          const color = `rgb(${r}, ${g}, ${b})`;
          ctx.beginPath();
          ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle + 1 / 32); // 添加 1/32 的角度以避免缝隙
          ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
        }
      }

      function initColorSelectorBackground() {
        if (!colorSelector.getContext) return;
        const ctx = colorSelector.getContext("2d");

        // 填充灰色背景
        ctx.fillStyle = "gray";
        ctx.fillRect(0, 0, colorSelector.width, colorSelector.height);

        let r =
          (colorSelector.width < colorSelector.height
            ? colorSelector.width / 2
            : colorSelector.height / 2) - 8;

        drawAngularGradientRing(ctx, r + 8, r + 8, r - 25, r); // 圆心(200,200)，内半径50，外半径100
      }

      function initPrintToolSize() {
        const parentWidth = printToolSelector.parentElement.clientWidth;
        const parentHeight = printToolSelector.parentElement.clientHeight;

        printToolSelector.width = parentWidth;
        printToolSelector.height = parentHeight * 0.6;
      }

      function initPrintToolBackground() {
        if (!printToolSelector.getContext) return;
        const ctx = printToolSelector.getContext("2d");

        ctx.fillStyle = "gray";
        ctx.fillRect(0, 0, printToolSelector.width, printToolSelector.height);

        ctx.fillStyle = "green"; // 三角形颜色为红色

        ctx.beginPath();
        ctx.moveTo(50, 50); // 起始点
        ctx.lineTo(50, 100); // 第二个点
        ctx.lineTo(100, 100); // 第三个点
        ctx.closePath(); // 闭合路径
        ctx.fill(); // 填充三角形
      }

      initColorSelectorSize();
      initColorSelectorBackground();
      initPrintToolSize();
      initPrintToolBackground();
    </script>
  </body>
</html>
